!function(a){"use strict";var b=Backbone.Router.extend({}),c=function(){var c=[],d={},e=new b,f=function(a,b){d[b]?d[b].modules.push(a):d[b]={modules:[a]}},g=function(){a.each(d,function(b,d){e.route(b,b,function(){a.each(d.modules,function(a,b){c[b.name]=new b.Callback(b.options)})})})};return{Events:_.extend({},Backbone.Events),Modules:c,getSettings:function(a){return"undefined"!=typeof window["mlp"+a+"Settings"]?window["mlp"+a+"Settings"]:"undefined"!=typeof window[a]?window[a]:{}},registerModule:function(b,c,d,e){var g={name:c,Callback:d,options:e||{}};a.each(_.isArray(b)?b:[b],function(a,b){f(g,b)})},initialize:function(){g(),Backbone.history.start({root:mlpSettings.urlRoot,pushState:!0,hashChange:!1})}}};window.MultilingualPress=new c,a(window.MultilingualPress.initialize)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"body",events:{"click .mlp-click-toggler":"toggleElement"},initialize:function(){this.initializeStateTogglers()},initializeStateTogglers:function(){a(".mlp-state-toggler").each(function(b,c){var d=a(c);a('[name="'+d.attr("name")+'"]').on("change",{$toggler:d},this.toggleElementIfChecked)}.bind(this))},toggleElementIfChecked:function(b){var c=b.data.$toggler,d=c.data("toggle-target");d&&a(d).toggle(c.is(":checked"))},toggleElement:function(b){var c=a(b.target).data("toggle-target")||"";c&&a(c).toggle()}});MultilingualPress.Modules.Common=new b}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("NavMenus"),c=Backbone.Model.extend({urlRoot:ajaxurl}),d=Backbone.View.extend({el:"#"+b.metaBoxID,events:{"click #submit-mlp-language":"sendRequest"},initialize:function(){this.$languages=this.$el.find('li [type="checkbox"]'),this.$menu=a("#menu"),this.$menuToEdit=a("#menu-to-edit"),this.$spinner=this.$el.find(".spinner"),this.$submit=this.$el.find("#submit-mlp-language"),this.model=new c,this.listenTo(this.model,"change",this.render)},sendRequest:function(a){var c={action:b.action,menu:this.$menu.val(),mlp_sites:this.getSites()};c[b.nonceName]=b.nonce,a.preventDefault(),this.$submit.prop("disabled",!0),this.$spinner.addClass("is-active").show(),this.model.fetch({data:c,processData:!0})},getSites:function(){var b=[];return this.$languages.filter(":checked").each(function(){b.push(Number(a(this).val()||0))}),b},render:function(){this.model.get("success")&&this.$menuToEdit.append(this.model.get("data")),this.$languages.prop("checked",!1),this.$spinner.addClass("is-active").hide(),this.$submit.prop("disabled",!1)}});MultilingualPress.registerModule("nav-menus.php","NavMenus",d)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"#wpbody-content form",events:{"change #site-language":"adaptLanguage","change #mlp-base-site-id":"togglePluginsRow"},template:_.template(a("#mlp-add-new-site-template").html()||""),initialize:function(){this.render(),this.$language=a("#mlp-site-language"),this.$pluginsRow=a("#mlp-activate-plugins").closest("tr")},render:function(){this.$el.find(".submit").before(this.template())},adaptLanguage:function(b){var c=this.getLanguage(a(b.target));this.$language.find('[value="'+c+'"]').length&&this.$language.val(c)},getLanguage:function(a){var b=a.val();return b?b.replace("_","-"):"en-US"},togglePluginsRow:function(b){this.$pluginsRow.toggle(0<a(b.target).val())}});MultilingualPress.registerModule("network/site-new.php","AddNewSite",b)}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("CopyPost"),c=Backbone.Model.extend({urlRoot:ajaxurl}),d=Backbone.View.extend({el:"#post-body",events:{"click .mlp-copy-post-button":"copyPostData"},initialize:function(){this.$content=a("#content"),this.$excerpt=a("#excerpt"),this.$slug=a("#editable-post-name"),this.$title=a("#title"),this.model=new c,this.listenTo(this.model,"change",this.updatePostData),this.postID=a("#post_ID").val()},copyPostData:function(c){var d={},e=this.getRemoteSiteID(a(c.target));c.preventDefault(),a("#mlp-translation-data-"+e+"-copied-post").val(1),MultilingualPress.Events.trigger("CopyPost:copyPostData",d,b.siteID,this.postID,e),d=_.extend(d,{action:b.action,current_post_id:this.postID,remote_site_id:e,title:this.getTitle(),slug:this.getSlug(),content:this.getContent(),excerpt:this.getExcerpt()}),this.model.fetch({data:d,processData:!0})},getRemoteSiteID:function(a){return a.data("site-id")||0},getTitle:function(){return this.$title.val()||""},getSlug:function(){return this.$slug.text()||""},getContent:function(){return this.$content.val()||""},getExcerpt:function(){return this.$excerpt.val()||""},updatePostData:function(){var b,c;this.model.get("success")&&(b=this.model.get("data"),c="mlp-translation-data-"+b.siteID+"-",a("#"+c+"title").val(b.title),a("#"+c+"name").val(b.slug),this.setTinyMCEContent(c+"content",b.content),a("#"+c+"content").val(b.content),a("#"+c+"excerpt").val(b.excerpt),MultilingualPress.Events.trigger("CopyPost:updatePostData",b))},setTinyMCEContent:function(a,b){var c;"undefined"!=typeof window.tinyMCE&&(c=window.tinyMCE.get(a),c&&c.setContent(b))}});MultilingualPress.registerModule(["post.php","post-new.php"],"CopyPost",d)}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("RelationshipControl"),c=Backbone.View.extend({el:"body",events:{"change .mlp-rc-actions input":"updateUnsavedRelationships","click #publish":"confirmUnsavedRelationships","click .mlp-save-relationship-button":"saveRelationship"},initialize:function(){this.unsavedRelationships=[],this.initializeEventHandlers()},initializeEventHandlers:function(){MultilingualPress.Events.on({"RelationshipControl:connectExistingPost":this.connectExistingPost,"RelationshipControl:connectNewPost":this.connectNewPost,"RelationshipControl:disconnectPost":this.disconnectPost},this)},updateUnsavedRelationships:function(b){var c=a(b.target),d=c.closest(".mlp-translation-meta-box"),e=d.find(".mlp-save-relationship-button"),f=this.findMetaBox(d);"stay"===c.val()?(e.prop("disabled","disabled"),-1!==f&&this.unsavedRelationships.splice(f,1)):-1===f&&(this.unsavedRelationships.push(d),e.removeAttr("disabled"))},findMetaBox:function(b){return a.each(this.unsavedRelationships,function(a,c){return c===b?a:void 0}),-1},confirmUnsavedRelationships:function(a){this.unsavedRelationships.length&&!window.confirm(b.L10n.unsavedRelationships)&&a.preventDefault()},saveRelationship:function(b){var c=a(b.target),d=c.data("remote-site-id"),e=a('input[name="mlp-rc-action['+d+']"]:checked').val(),f=this.getEventName(e);"stay"!==e&&(c.prop("disabled","disabled"),MultilingualPress.Events.trigger("RelationshipControl:"+f,{action:"mlp_rc_"+e,remote_site_id:d,remote_post_id:c.data("remote-post-id"),source_site_id:c.data("source-site-id"),source_post_id:c.data("source-post-id")},f))},getEventName:function(a){switch(a){case"search":return"connectExistingPost";case"new":return"connectNewPost";case"disconnect":return"disconnectPost";default:return""}},connectNewPost:function(b){b.new_post_title=a('input[name="post_title"]').val(),this.sendRequest(b)},disconnectPost:function(a){this.sendRequest(a)},connectExistingPost:function(c){var d=a('input[name="mlp_add_post['+c.remote_site_id+']"]:checked').val()||0;d?(c.new_post_id=Number(d),this.sendRequest(c)):window.alert(b.L10n.noPostSelected)},sendRequest:function(b){a.ajax({type:"POST",url:ajaxurl,data:b,success:this.reloadLocation,async:!1})},reloadLocation:function(){window.location.reload(!0)}});MultilingualPress.registerModule(["post.php","post-new.php"],"RelationshipControl",c)}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("RemotePostSearch"),c=Backbone.Model.extend({urlRoot:ajaxurl}),d=Backbone.View.extend({el:"body",events:{"keydown .mlp-search-field":"preventFormSubmission","keyup .mlp-search-field":"reactToInput"},initialize:function(){this.defaultResults=[],this.resultsContainers=[],this.searchThreshold=parseInt(b.searchThreshold,10),this.model=new c,this.listenTo(this.model,"change",this.render),a(".mlp-search-field").each(function(b,c){var d=a(c),e=a("#"+d.data("results-container-id")),f=d.data("remote-site-id");this.defaultResults[f]=e.html(),this.resultsContainers[f]=e}.bind(this))},preventFormSubmission:function(a){13===a.which&&a.preventDefault()},reactToInput:function(b){var c,d=a(b.target),e=a.trim(d.val()||"");e!==d.data("value")&&(clearTimeout(this.reactToInputTimer),d.data("value",e),c=d.data("remote-site-id"),""===e?this.resultsContainers[c].html(this.defaultResults[c]):e.length>=this.searchThreshold&&(this.reactToInputTimer=setTimeout(function(){this.model.fetch({data:{action:"mlp_rc_remote_post_search",remote_site_id:c,remote_post_id:d.data("remote-post-id"),source_site_id:d.data("source-site-id"),source_post_id:d.data("source-post-id"),s:e},processData:!0})}.bind(this),400)))},render:function(){var a;this.model.get("success")&&(a=this.model.get("data"),this.resultsContainers[a.remoteSiteID].html(a.html))}});MultilingualPress.registerModule(["post.php","post-new.php"],"RemotePostSearch",d)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"#mlp-term-translations",events:{"change select":"propagateSelectedTerm"},initialize:function(){this.$selects=this.$el.find("select")},propagateSelectedTerm:function(b){var c,d;this.isPropagating||(this.isPropagating=!0,c=a(b.target),d=this.getSelectedRelation(c),""!==d&&this.$selects.not(c).each(function(b,c){this.selectTerm(a(c),d)}.bind(this)),this.isPropagating=!1)},getSelectedRelation:function(a){return a.find("option:selected").data("relation")||""},selectTerm:function(a,b){var c=a.find('option[data-relation="'+b+'"]');c.length?a.val(c.val()):this.getSelectedRelation(a)&&a.val(a.find("option").first().val())}});MultilingualPress.registerModule("edit-tags.php","TermTranslator",b)}(jQuery),function(){"use strict";var a=MultilingualPress.getSettings("UserBackendLanguage"),b=Backbone.View.extend({el:"#WPLANG",initialize:function(){this.$el.val(a.locale)}});MultilingualPress.registerModule("options-general.php","UserBackendLanguage",b)}();